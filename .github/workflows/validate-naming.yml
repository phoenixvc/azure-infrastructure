name: Validate Naming Conventions

on:
workflow_call:
  inputs:
    bicep_path:
      description: 'Path to Bicep files to validate'
      required: false
      type: string
      default: './infra'

jobs:
validate:
  runs-on: ubuntu-latest
  name: Validate Resource Naming
  
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install validator
      run: |
        pip install -r tools/validator/requirements.txt
    
    - name: Validate Bicep files
      run: |
        echo "Validating naming conventions in ${{ inputs.bicep_path }}"
        
        # Extract resource names from Bicep files and validate
        find ${{ inputs.bicep_path }} -name "*.bicep" -type f | while read file; do
          echo "Checking: $file"
          # This is a placeholder - actual validation logic would parse Bicep
          grep -oP "name:\s*'\K[^']+" "$file" | while read name; do
            python tools/validator/nl_az_name.py validate "$name" || true
          done
        done
    
    - name: Summary
      run: |
        echo "âœ… Naming validation complete"
