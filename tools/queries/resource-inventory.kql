// Azure Resource Graph Query: Resource Inventory
// Groups all resources by org/env/project

Resources
| where type !in ('microsoft.resources/subscriptions')
| extend nameParts = split(name, '-')
| extend org = tostring(nameParts[0])
| extend env = tostring(nameParts[1])
| extend project = tostring(nameParts[2])
| summarize 
  ResourceCount = count(),
  ResourceTypes = make_set(type)
by org, env, project, resourceGroup
| order by org, env, project
